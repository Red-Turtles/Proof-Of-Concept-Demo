<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Animal Species Identifier (PoC)</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  {% if use_recaptcha and recaptcha_site_key %}
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  {% endif %}
</head>
<body>
  <header>
    <h1>üêæ Animal Identifier (PoC)</h1>
    <p>Upload an image ‚Üí Get animal species identification from Together.ai</p>
  </header>
  <main class="container">
    <section class="card">
      <h2>Upload an animal image</h2>
      <p class="desc">Accepted: PNG, JPG, JPEG, GIF, BMP, WEBP (max 10 MB)</p>
      
      <!-- Security Status -->
      <div id="security-status" class="security-status" style="display: none;">
        <div class="security-info">
          <span class="security-icon">üîí</span>
          <span id="security-message">Security verification required</span>
        </div>
      </div>
      
      <!-- CAPTCHA Section -->
      {% if use_recaptcha and recaptcha_site_key %}
      <div id="captcha-section" class="captcha-section" style="display: block;">
        <h3>Security Verification</h3>
        {% if error_message %}
        <div class="security-message error">{{ error_message }}</div>
        {% endif %}
        <form id="captcha-form" action="/verify-captcha" method="post">
          <div class="captcha-container">
            <div class="g-recaptcha" data-sitekey="{{ recaptcha_site_key }}"></div>
            <button type="submit" class="captcha-submit-btn">Verify</button>
          </div>
        </form>
        <p class="captcha-note">Protected by reCAPTCHA ‚Ä¢ <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy</a> ‚Ä¢ <a href="https://policies.google.com/terms" target="_blank" rel="noopener">Terms</a></p>
      </div>
      {% elif captcha_data %}
      <div id="captcha-section" class="captcha-section" style="display: block;">
        <h3>Security Verification</h3>
        <p class="captcha-desc">Please solve the math problem to continue:</p>
        {% if error_message %}
        <div class="security-message error">{{ error_message }}</div>
        {% endif %}
        <form id="captcha-form" action="/verify-captcha" method="post">
          <div class="captcha-container">
            <div class="captcha-question">
              {{ captcha_data.question }} = ?
            </div>
            <input type="hidden" name="captcha_id" value="{{ captcha_data.captcha_id }}" />
            <input type="number" name="captcha_answer" placeholder="Your answer" required />
            <button type="submit" class="captcha-submit-btn">Verify</button>
            <a href="/" class="refresh-btn">üîÑ</a>
          </div>
        </form>
        <p class="captcha-note">After 2 image identifications, additional verification may be required.</p>
      </div>
      {% endif %}
      
      <form id="upload-form" action="/identify" method="post" enctype="multipart/form-data">
        <div class="form-row">
          <input type="file" name="file" accept=".png,.jpg,.jpeg,.gif,.bmp,.webp" required />
          <button type="submit" id="submit-btn">Identify</button>
        </div>
        <div class="form-row">
          <p class="small">Powered by Together.ai - Qwen2.5-VL Vision Model</p>
        </div>
        <p class="small">Your file is removed right after analysis.</p>
      </form>
    </section>
  </main>
  <footer>Animal Species Identification ‚Ä¢ Auto file cleanup ‚Ä¢ Interactive habitat mapping</footer>
</body>
</html>