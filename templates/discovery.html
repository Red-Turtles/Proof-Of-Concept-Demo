<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>Animal Discovery - WildID</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
<body>
  <!-- Header Navigation -->
  <nav class="header-nav">
    <div class="nav-container">
      <div class="logo">
        <span class="logo-icon">üçÉ</span>
        <span class="logo-text">WildID</span>
      </div>
      <div class="nav-links">
        <a href="/" class="nav-link">Home</a>
        <a href="/discovery" class="nav-link active">Discovery</a>
          <a href="/docs/diagrams" class="nav-link" target="_blank" rel="noopener">Diagrams</a>
          {% if current_user %}
            <a href="/history" class="nav-link">History</a>
            <form action="/auth/logout" method="post" class="logout-form">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
              <button type="submit" class="nav-link logout-button">Sign Out</button>
            </form>
          {% else %}
          <a href="/auth/login" class="nav-link">Sign In</a>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="discovery-main">
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">Animal Discovery</h1>
        <p class="page-description">
          Upload a photo of any animal and our AI will identify it, providing detailed information about the species, conservation status, and habitat.
        </p>
        <p class="demo-mode">Demo mode: Using simulated AI with color pattern recognition.</p>
      </div>

      <!-- Upload Section -->
      <section class="discovery-card">
        <h2>Upload Animal Photo</h2>
        
        {% if not current_user %}
        <div class="auth-notice" style="padding: 16px; background: #e3f2fd; border-radius: 8px; margin-bottom: 20px; text-align: center;">
          <p style="margin: 0; color: #1976d2;">
            <strong>üí° Sign in to save your discoveries!</strong> 
            <a href="/auth/login" style="color: #1565c0; text-decoration: underline;">Sign in here</a>
          </p>
        </div>
        {% endif %}
        
          <form id="upload-form" action="/identify" method="post" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <div class="discovery-upload-area">
            <div class="upload-content">
              <div class="upload-icon">‚¨Ü</div>
              <div class="upload-text">
                <span class="upload-title">Click to upload or drag and drop</span>
              </div>
              <div class="upload-subtitle">
                <span class="file-types">PNG, JPG, or WEBP (MAX. 16MB)</span>
              </div>
              <input type="file" name="file" accept=".png,.jpg,.jpeg,.gif,.bmp,.webp" required id="file-input" />
            </div>
            <div class="file-info" id="file-info" style="display: none;">
              <span class="file-name" id="file-name"></span>
              <button type="button" class="remove-file" id="remove-file">‚úï</button>
            </div>
          </div>
            <div id="security-status" class="security-status-banner" style="display: none;">
              <p id="security-message"></p>
            </div>
            <div id="captcha-challenge" class="captcha-challenge" style="display: none;">
              <div class="captcha-header">
                <span class="captcha-label">Security Check</span>
                <button type="button" class="captcha-refresh-btn" id="captcha-refresh-btn" aria-label="New challenge">‚Üª</button>
              </div>
              <div class="captcha-question" id="captcha-question"></div>
              <div class="captcha-input-group">
                <input type="text" id="captcha-answer" name="captcha_answer" placeholder="Enter the answer" autocomplete="off" />
                <button type="button" class="captcha-submit-btn" id="captcha-submit-btn">Verify</button>
              </div>
              <p class="captcha-feedback" id="captcha-feedback"></p>
            </div>
          <div class="form-row">
            <button type="submit" id="submit-btn" disabled>Identify Animal</button>
          </div>
          <div class="form-row">
            <p class="small">Powered by Together.ai - Qwen2.5-VL Vision Model</p>
          </div>
          <p class="small">Your file is removed right after analysis.</p>
        </form>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>WildID ‚Ä¢ Wildlife Identification ‚Ä¢ Auto file cleanup ‚Ä¢ Interactive habitat mapping</p>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
